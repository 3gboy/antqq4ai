<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电磁波传播动画</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        
        #canvas {
            border: 1px solid #333;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f23 100%);
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        label {
            font-size: 12px;
        }
        
        input[type="range"] {
            width: 100px;
        }
        
        button {
            padding: 8px 16px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #555;
        }
        
        .legend {
            margin-top: 20px;
            display: flex;
            gap: 30px;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
        }
    </style>
</head>
<body>
    <h1>电磁波基本传播理论动画</h1>
    <canvas id="canvas" width="900" height="500"></canvas>
    
    <div class="controls">
        <div class="control-group">
            <label>频率</label>
            <input type="range" id="frequency" min="0.5" max="3" step="0.1" value="1">
            <span id="freqValue">1.0</span>
        </div>
        
        <div class="control-group">
            <label>振幅</label>
            <input type="range" id="amplitude" min="20" max="80" step="5" value="50">
            <span id="ampValue">50</span>
        </div>
        
        <div class="control-group">
            <label>波长</label>
            <input type="range" id="wavelength" min="50" max="200" step="10" value="100">
            <span id="waveValue">100</span>
        </div>
        
        <button id="playPause">暂停</button>
        <button id="reset">重置</button>
    </div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: #ff4444;"></div>
            <span>电场 (E)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4444ff;"></div>
            <span>磁场 (B)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #44ff44;"></div>
            <span>传播方向</span>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // 控制元素
        const frequencySlider = document.getElementById('frequency');
        const amplitudeSlider = document.getElementById('amplitude');
        const wavelengthSlider = document.getElementById('wavelength');
        const playPauseBtn = document.getElementById('playPause');
        const resetBtn = document.getElementById('reset');
        
        // 显示值的元素
        const freqValue = document.getElementById('freqValue');
        const ampValue = document.getElementById('ampValue');
        const waveValue = document.getElementById('waveValue');
        
        // 动画参数
        let time = 0;
        let isPlaying = true;
        let animationId;
        
        // 波形参数
        let frequency = 1.0;
        let amplitude = 50;
        let wavelength = 100;
        
        // 3D投影参数
        const perspective = 400;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        
        // 3D坐标转换为2D
        function project3D(x, y, z) {
            const scale = perspective / (perspective + z);
            return {
                x: centerX + x * scale,
                y: centerY + y * scale,
                scale: scale
            };
        }
        
        // 更新参数值显示
        function updateValues() {
            frequency = parseFloat(frequencySlider.value);
            amplitude = parseInt(amplitudeSlider.value);
            wavelength = parseInt(wavelengthSlider.value);
            
            freqValue.textContent = frequency.toFixed(1);
            ampValue.textContent = amplitude;
            waveValue.textContent = wavelength;
        }
        
        // 绘制3D坐标轴
        function draw3DAxes() {
            // X轴 (传播方向，红色)
            const xStart = project3D(-300, 0, 0);
            const xEnd = project3D(300, 0, 0);
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(xStart.x, xStart.y);
            ctx.lineTo(xEnd.x, xEnd.y);
            ctx.stroke();
            
            // Y轴 (电场方向，绿色)
            const yStart = project3D(0, -150, 0);
            const yEnd = project3D(0, 150, 0);
            ctx.strokeStyle = '#666';
            ctx.beginPath();
            ctx.moveTo(yStart.x, yStart.y);
            ctx.lineTo(yEnd.x, yEnd.y);
            ctx.stroke();
            
            // Z轴 (磁场方向，蓝色)
            const zStart = project3D(0, 0, -150);
            const zEnd = project3D(0, 0, 150);
            ctx.strokeStyle = '#666';
            ctx.beginPath();
            ctx.moveTo(zStart.x, zStart.y);
            ctx.lineTo(zEnd.x, zEnd.y);
            ctx.stroke();
            
            // 轴标签
            ctx.fillStyle = '#aaa';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('X (传播)', xEnd.x + 20, xEnd.y);
            ctx.fillText('Y (电场)', yEnd.x, yEnd.y - 10);
            ctx.fillText('Z (磁场)', zEnd.x + 15, zEnd.y + 5);
        }
        
        // 绘制3D电磁波
        function draw3DElectromagneticWave() {
            const steps = 200;
            const xRange = 600;
            
            // 绘制电场波形 (在XY平面)
            ctx.strokeStyle = '#ff4444';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let firstPoint = true;
            for (let i = 0; i <= steps; i++) {
                const x = -xRange/2 + (i / steps) * xRange;
                const phase = (x * 2 * Math.PI / wavelength) - time * frequency;
                const y = amplitude * Math.sin(phase);
                const z = 0;
                
                const point = project3D(x, y, z);
                
                if (firstPoint) {
                    ctx.moveTo(point.x, point.y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            }
            ctx.stroke();
            
            // 绘制磁场波形 (在XZ平面)
            ctx.strokeStyle = '#4444ff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            firstPoint = true;
            for (let i = 0; i <= steps; i++) {
                const x = -xRange/2 + (i / steps) * xRange;
                const phase = (x * 2 * Math.PI / wavelength) - time * frequency;
                const y = 0;
                const z = amplitude * Math.sin(phase);
                
                const point = project3D(x, y, z);
                
                if (firstPoint) {
                    ctx.moveTo(point.x, point.y);
                    firstPoint = false;
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            }
            ctx.stroke();
        }
        
        // 绘制3D矢量箭头
        function draw3DFieldVectors() {
            const vectorSpacing = wavelength / 3;
            const xRange = 400;
            
            for (let x = -xRange/2; x <= xRange/2; x += vectorSpacing) {
                const phase = (x * 2 * Math.PI / wavelength) - time * frequency;
                const eFieldY = amplitude * Math.sin(phase) * 0.7;
                const bFieldZ = amplitude * Math.sin(phase) * 0.7;
                
                // 电场矢量 (Y方向)
                if (Math.abs(eFieldY) > 5) {
                    const start = project3D(x, 0, 0);
                    const end = project3D(x, eFieldY, 0);
                    
                    ctx.strokeStyle = '#ff6666';
                    ctx.lineWidth = 2;
                    draw3DArrow(start, end);
                }
                
                // 磁场矢量 (Z方向)
                if (Math.abs(bFieldZ) > 5) {
                    const start = project3D(x, 0, 0);
                    const end = project3D(x, 0, bFieldZ);
                    
                    ctx.strokeStyle = '#6666ff';
                    ctx.lineWidth = 2;
                    draw3DArrow(start, end);
                }
            }
        }
        
        // 绘制3D箭头
        function draw3DArrow(start, end) {
            // 箭头主体
            ctx.beginPath();
            ctx.moveTo(start.x, start.y);
            ctx.lineTo(end.x, end.y);
            ctx.stroke();
            
            // 箭头头部
            const dx = end.x - start.x;
            const dy = end.y - start.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            
            if (length > 10) {
                const headLength = 8;
                const angle = Math.atan2(dy, dx);
                
                ctx.beginPath();
                ctx.moveTo(end.x, end.y);
                ctx.lineTo(end.x - headLength * Math.cos(angle - Math.PI / 6), 
                          end.y - headLength * Math.sin(angle - Math.PI / 6));
                ctx.moveTo(end.x, end.y);
                ctx.lineTo(end.x - headLength * Math.cos(angle + Math.PI / 6), 
                          end.y - headLength * Math.sin(angle + Math.PI / 6));
                ctx.stroke();
            }
        }
        
        // 绘制传播方向指示
        function drawPropagationDirection() {
            // 传播方向箭头
            const arrowStart = project3D(-250, -120, 0);
            const arrowEnd = project3D(250, -120, 0);
            
            ctx.strokeStyle = '#44ff44';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(arrowStart.x, arrowStart.y);
            ctx.lineTo(arrowEnd.x, arrowEnd.y);
            ctx.stroke();
            
            // 箭头头部
            const dx = arrowEnd.x - arrowStart.x;
            const dy = arrowEnd.y - arrowStart.y;
            const angle = Math.atan2(dy, dx);
            const headLength = 15;
            
            ctx.beginPath();
            ctx.moveTo(arrowEnd.x, arrowEnd.y);
            ctx.lineTo(arrowEnd.x - headLength * Math.cos(angle - Math.PI / 6), 
                      arrowEnd.y - headLength * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(arrowEnd.x, arrowEnd.y);
            ctx.lineTo(arrowEnd.x - headLength * Math.cos(angle + Math.PI / 6), 
                      arrowEnd.y - headLength * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
            
            // 标签
            ctx.fillStyle = '#44ff44';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('传播方向 (c = 3×10⁸ m/s)', centerX, arrowEnd.y + 30);
        }
        
        // 绘制网格平面
        function drawGridPlanes() {
            ctx.strokeStyle = '#222';
            ctx.lineWidth = 1;
            
            // XY平面网格 (电场平面)
            for (let i = -200; i <= 200; i += 50) {
                // 垂直线
                const start1 = project3D(i, -100, 0);
                const end1 = project3D(i, 100, 0);
                ctx.beginPath();
                ctx.moveTo(start1.x, start1.y);
                ctx.lineTo(end1.x, end1.y);
                ctx.stroke();
                
                // 水平线
                const start2 = project3D(-200, i, 0);
                const end2 = project3D(200, i, 0);
                ctx.beginPath();
                ctx.moveTo(start2.x, start2.y);
                ctx.lineTo(end2.x, end2.y);
                ctx.stroke();
            }
        }
        
        // 主绘制函数
        function draw() {
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制网格
            drawGridPlanes();
            
            // 绘制坐标轴
            draw3DAxes();
            
            // 绘制电磁波
            draw3DElectromagneticWave();
            
            // 绘制场矢量
            draw3DFieldVectors();
            
            // 绘制传播方向
            drawPropagationDirection();
            
            // 添加信息文本
            ctx.fillStyle = '#fff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('电场 E (红色) - 垂直振荡', 20, 30);
            ctx.fillText('磁场 B (蓝色) - 水平振荡', 20, 50);
            ctx.fillText('E ⊥ B ⊥ 传播方向', 20, 70);
            
            // 显示当前参数
            ctx.textAlign = 'right';
            ctx.fillText(`频率: ${frequency.toFixed(1)} Hz`, canvas.width - 20, 30);
            ctx.fillText(`波长: ${wavelength} 像素`, canvas.width - 20, 50);
            ctx.fillText(`振幅: ${amplitude} 像素`, canvas.width - 20, 70);
        }
        
        // 动画循环
        function animate() {
            if (isPlaying) {
                time += 0.08;
                draw();
            }
            animationId = requestAnimationFrame(animate);
        }
        
        // 事件监听器
        frequencySlider.addEventListener('input', updateValues);
        amplitudeSlider.addEventListener('input', updateValues);
        wavelengthSlider.addEventListener('input', updateValues);
        
        playPauseBtn.addEventListener('click', () => {
            isPlaying = !isPlaying;
            playPauseBtn.textContent = isPlaying ? '暂停' : '播放';
        });
        
        resetBtn.addEventListener('click', () => {
            time = 0;
            draw();
        });
        
        // 初始化
        updateValues();
        animate();
    </script>
</body>
</html>